report_comment: >
  This report has been generated by the <a href="https://github.com/scilus/sf-tractomics/" target="_blank">scilus/sf-tractomics</a>
  analysis pipeline.

report_section_order:
  software_versions:
    order: -1001
  "scilus-sf-tractomics-summary":
    title: "sf-tractomics Workflow Summary"
    order: -1002
  "sf-tractomics-methods-description":
    order: -1000
  tracking_qc:
    order: 100
  anattodwi_qc:
    order: 200
  metrics_qc:
    order: 300
  eddy_qc:
    order: 400
  framewise_displacement:
    order: 500
  bundle_seg_qc:
    order: 50

modules_order:
  - framewise_displacement
  - custom_content

custom_content:
  order:
    - topup_qc
    - eddy_qc
    - anattodwi_qc
    - metrics_qc
    - tracking_qc

custom_data:
  eddy_qc:
    file_format: "gif"
    section_name: "Eddy QC"
    description: |
      This section contains QC images for EDDY correction, which is used to
      correct distortions and motion artifacts. The animation shows a
      before-and-after comparison of the correction. To assess the quality of
      the correction, focus on areas prone to distortions, such as the frontal
      lobe and the cerebellum/spinal cord region. Look for reduced geometric warping,
      improved alignment with anatomical boundaries, and correction of
      eddy-current-induced displacements. Additionally, ensure that no new
      artifacts or excessive blurring are introduced in the corrected images.
    plot_type: "image"
  topup_qc:
    file_format: "gif"
    section_name: "Topup QC"
    description: |
      This section contains QC images for TOPUP correction, which is used to correct
      susceptibility-induced distortions by leveraging pairs of images acquired with
      opposite phase-encoding directions. The animation shows a before-and-after
      comparison of the correction. To assess the quality of the correction, focus
      on regions most affected by susceptibility distortions, such as the frontal lobe
      and the cerebellum/spinal cord area. Look for improved alignment of anatomical
      structures, reduced stretching or compression, and better symmetry between the
      corrected images. Additionally, ensure that the correction does not introduce
      new artifacts or excessive blurring.
    plot_type: "image"
  anattodwi_qc:
    file_format: "gif"
    section_name: "Registration of anatomical image in DWI space QC"
    description: |
      This section contains QC images for the registration of the T1-weighted
      structural image to diffusion space, using the b0 image as a reference.
      This step ensures accurate alignment between structural and diffusion
      data. To assess the quality of the registration, check for good alignment
      of anatomical structures. Specifically, look for proper overlay of cortical
      and subcortical structures without excessive warping, stretching,
      or misalignment. Pay particular attention to boundaries such as the
      ventricles and major white matter tracts, ensuring they match well
      between the T1-weighted and b0 images. If misalignment is present,
      consider flagging this specific subject for further review.
    plot_type: "image"
  metrics_qc:
    file_format: "tsv"
    section_name: "Metrics QC" # This is the new section name
    description: |
      This section contains QC images for diffusion tensor imaging
      (DTI) metric maps, including fractional anisotropy
      (FA), mean diffusivity (MD), axial diffusivity (AD), radial diffusivity (RD),
      RGB FA, and the fit residuals.
      To assess the quality of the DTI metrics, ensure that FA highlights major
      white matter tracts with expected high values (e.g., corpus callosum,
      corticospinal tract) and that MD and RGB FA  follow known
      anatomical distributions. Look for smooth, artifact-free maps, avoiding
      unexpected signal dropout, distortions, or excessive noise. Pay special
      attention to regions prone to artifacts, such as near the ventricles or
      areas affected by eddy currents and susceptibility distortions.
    plot_type: "image"
  tracking_qc:
    file_format: "tsv"
    section_name: "Tracking Coverage" # This is the new section name
    description: |
      This section contains QC images of tractography coverage, shown as an
      overlay of the tract density image (pink) with the WM mask (green).
      This visualization assesses how well
      the reconstructed streamlines cover the white matter mask used for
      tracking, with higher coverage generally indicating better results.
      To evaluate tracking quality, check that the tract density image spans
      the full extent of the white matter mask, ensuring that major pathways
      (e.g., corpus callosum, corticospinal tract) are well-represented.
      Ideally, the coverage should be uniform across the mask, with minimal
      gaps or missing regions. Areas of low coverage may indicate poor
      tracking due to insufficient diffusion signal, masking errors, or
      overly restrictive tracking parameters. Conversely, excessive streamlines
      outside the mask may suggest tracking leakage into non-white matter
      regions, requiring further filtering.
    plot_type: "image"
  tractogram_qc:
    file_format: "tsv"
    section_name: "Tractogram QC"
    description: |
      This section contains QC images for the tractogram, visualizing the
      reconstructed streamlines from diffusion MRI data.
      To assess the quality of the tractogram, ensure that the streamlines
      accurately represent known white matter pathways without excessive
      noise or artifacts. Look for well-defined bundles that correspond to
      major tracts (e.g., corpus callosum, corticospinal tract) and check
      for uniform distribution throughout the brain's white matter.
      Avoid over-clustering of streamlines or unrealistic trajectories that
      deviate significantly from anatomical norms. If issues are observed,
      consider reviewing tracking parameters or preprocessing steps.
    plot_type: "image"
  bundle_seg_qc:
    file_format: "png"
    section_name: "Bundle Segmentation QC"
    description: |
      This section contains a mosaic image for the bundle segmentation,
      visualizing the segmented white matter bundles from the tractogram.
      To assess the quality of the bundle segmentation, ensure that the
      segmented bundles accurately correspond to known anatomical pathways.
    plot_type: "image"

sp:
  framewise_displacement:
    fn: "*dwi_eddy_restricted_movement_rms.txt"
  topup_qc:
    fn: "*_b0_topup_mqc.gif"
  eddy_qc:
    fn: "*_dwi_eddy_mqc.gif"
  anattodwi_qc:
    fn: "*_registration_anattodwi_mqc.gif"
  metrics_qc:
    fn: "*dti_mqc.png"
  tracking_qc:
    fn: "*coverage_overlay_mqc.png"
  tractogram_qc:
    fn: "*tracking_mqc"
  bundle_seg_qc:
    fn: "*_bundles_mosaic_mqc.png"

remove_sections:
  - tractogram_qc
  - bundle_seg_qc

# Customisable module parameters
framewise_displacement:
  warn_threshold: 0.5 # mm
  fail_threshold: 1.2 # mm

export_plots: true
